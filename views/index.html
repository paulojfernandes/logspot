<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
        crossorigin="anonymous">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
        crossorigin="anonymous"></script>

    <script>
        var map;




        function myMap() {
            var mapProp = {
                center: new google.maps.LatLng(51.508742, -0.120850),
                zoom: 5,
                mapTypeId: 'satellite'
            };
            map = new google.maps.Map(document.getElementById("googleMap"), mapProp);
        }

        function geoFindMe() {
            var output = document.getElementById("out");


            if (!navigator.geolocation) {
                output.innerHTML = "<p>Geolocation is not supported by your browser</p>";
                return;
            }

            function success(position) {
                var latitude = position.coords.latitude;
                var longitude = position.coords.longitude;


                output.innerHTML = '<p id="lat">' + latitude + '</p>' + '<p id="lng">' + longitude + '</p>'
                $("#form").show();
                // var img = new Image();
                // img.src = "https://maps.googleapis.com/maps/api/staticmap?center=" + latitude + "," + longitude + "&zoom=13&size=300x300&sensor=false";

                // output.appendChild(img);
                var marker = new google.maps.Marker({
                    position: { lat: latitude, lng: longitude },
                    title: "Sua Posição!"
                });

                marker.setMap(map);
                map.setCenter({ lat: latitude, lng: longitude });
                map.setZoom(15)
            }

            function error() {
                output.innerHTML = "Unable to retrieve your location";
            }

            output.innerHTML = "<p>Locating…</p>";



            if (navigator.geolocation) {

                navigator.geolocation.getCurrentPosition(success, error, { enableHighAccuracy: false, timeout: 90000, maximumAge: 6000000 })


            }

            ;
        }
    </script>


    <script type="text/javascript">
        $(function () {
            $('#enviar').on("click", function (e) {
                e.preventDefault();


                var data = {};
                data.dist = $('#dist').val();
                data.lat = $('#lat').text();
                data.lng = $('#lng').text();


                console.log(data);

                $.ajax({
                    type: 'POST',
                    data: JSON.stringify(data),
                    contentType: 'application/json',
                    url: 'https://logspot.herokuapp.com/home',
                    success: function (data) {
                        console.log('success:');
                        console.log(JSON.stringify(data));


                    }
                });
                
                alert("Dados enviados. Obrigado pela colaboração")
            });
        });
    </script>






</head>

<body>




    <div id="out"></div>

    <p><button onclick="geoFindMe()">Show my location</button></p>




    <div hidden id='form'>

        <div class="row">
            <div class="col-md-8">
                <H1>Local Certo ? </H1>
                <form action="http://127.0.0.1:3000/home" method="post">
                    <div class="form-group">
                        <label for=""> Distancia errada em Metros</label>
                        <input type="text" class="form-control" id="dist" name="dist" placeholder="Distancia Em Metros">
                    </div>
                    <button type="submit" id="enviar" class="btn btn-primary">Enviar</button>
                </form>
            </div>
        </div>

    </div>



    <div id="googleMap" style="width:100%;height:400px;"></div>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC5wc3qnKNCzEWhf-5LMO6ik1zcBkyW5kw&callback=myMap"></script>









</body>

</html>
